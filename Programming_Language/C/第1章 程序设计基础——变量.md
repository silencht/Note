

# 第一章 程序设计基础——变量

[toc]

 

## 1.1 变量定义和声明

###  1.1.1定义变量就是使用内存

1.如果一个变量占用内存空间的多个内存字节，其第一个字节地址就是它的存储地址

2.简单理解为变量就是内存的一个箱子，箱子的名称就是变量名，用户可以向其中放入数据，也可以取出其中的数据。

###  1.1.2变量的作用域和在内存中的存储方式

1.变量的作用域：确定变量的作用范围

- 局部变量：在函数内部定义的变量为内部变量，只在本函数范围内有效，在该函数外不能使用这些变量。

- 全局变量：在函数之外定义的变量为外部变量，作用域从定义变量的位置开始到本源程序文件结束，全局变量保存在静态存储区。

- C程序中局部变量和全局变量重名时，局部变量会屏蔽全局变量

 

2.变量的存储类别：确定变量存放在内存的位置

- auto：自动变量，缺省情况下，编译器默认所有局部变量为自动变量，它的存储空间由系统自动分配和释放，系统不会自动初始化。【影响】若定义局部变量时不初始化值，那么此时该局部变量为无意义的辣鸡值，因为自动变量不会初始化。

- register：寄存器变量，变量值存放在CPU内部寄存器中，存取速度最快，这类变量不能进行取变量地址操作。只有局部自动变量和函数形参才可以定义为寄存器变量。

- extern：外部变量，全局变量是从作用域角度提出，而外部变量是从存储类别提出。该关键字告诉编译器存在着一个变量或函数，即使在当前源程序文件中没有看到它，也不是错误的，它可能在另外一个源程序文件中或者在当前文件的后面定义。extern的作用有两个：

- 在函数中提前使用全局变量（提前声明），即在定义之前使用

- 使用其他源文件中的全局变量

- static：静态变量，在函数内部用该关键字定义的变量称为静态局部变量，在函数外部用static关键字定义的变量称为静态全局变量。

- 静态局部变量，程序执行期间，在内存的静态存储区中占据这永久性的存储单元，即便退出函数后，该变量的生命期也不终止，下次再次进入函数时，仍使用原来的存储单元。定义时初始化的静态局部变量，初始化仅仅执行一次；对于初始化的静态局部变量，C编译系统自动给它幅值0.

- 静态全局变量，作用域只限于本源程序文件。静态全局变量和普通全局变量的区别是静态全局变量只能初始化一次，由于静态全局变量的作用域限于本源程序文件内，只能为该源文件内的函数公用，因此可以避免在其他源文件中引用而引起错误。

3.内存组织结构

![](https://silencht.oss-cn-beijing.aliyuncs.com/img/19653046.png)

- 代码段：该内存区域属于只读，区域大小在程序执行前就已经确定

- 数据段：执行程序时，BSS段会预先清空，所以存放在BSS段的变量均默认初始化为0

- 堆空间：存放进程（可简单理解为程序的一次执行）执行中被动态分配的内存段，大小不固定，可动态扩张或缩减。从堆分配的内存仅能通过指针访问。速度一般较慢，容易产生内存碎片。

- 栈空间：方便用来保存/恢复调用现场，可以看作一个存放、交换临时数据的内存区。由系统自动分配，速度较快，程序员无法控制栈空间。

4.变量静态分配和动态分配方式

- 变量静态分配：程序编译期间分配固定的存储空间的方式。该存储分配方式在变量定义时就分配存储单元并一直保持不变，直到整个程序结束。所有变量都是采用静态分配方式。静、动态分配方式主要是针对指针变量（或者数组）指向的空间而言的。

- 变量动态分配：程序执行期间根据需要动态申请堆空间的方式。C语言提供了一套机制可以在程序执行时动态分配存储空间。如malloc(),calloc()等函数。

如果程序员在程序中采用动态分配方式分配大量内存空间，用完后不及时释放，可能会消耗完应用程序的内存空间，称之为**内存泄漏**。

## 1.2 运算符和表达式

### 1.2.1 C中的运算符

1.++n、n++、--n、n--的区别

- 虽然对于int数据类型的变量进行++、--运算完全可以用n=n±1完成，但是用++、--运算符可以提高程序的执行效率，因为++、--只需要一条机器指令就可以完成，而n=n±1需要对应三条机器指令

- 自增、自减运算符的运算对象只能是简单变量，不能是常数或是带有运算符的表达式

- 编译器实现n++、n--是先创建n的一个副本，然后n自增、自减1，最后返回这个副本的值，所以n++、n--不能作为左值（因为作为左值时改变的是副本的值）；而实现++n、--n是先n自增、自减1，最后返回n的值（不是副本的值），所以++n、--n可以作为左值。故for循环递增量表达式建议采用++i，而非i++，因为++i占用空间小。

![](https://silencht.oss-cn-beijing.aliyuncs.com/img/6d9e2fb7-72aa-43f5-be9d-e54f8265daea.png)

 

2.表达式中符号的求值

符号指的是程序的一个基本组成单元，其作用相当于一个句子中的单词。在C编译器解释表达式符号时，它在移动到下一个符号之前在单个符号中包括尽可能多的字符，即为贪心法。

- `i+++j`解释为`（i++）+j`

- `a+++++b`本应解释为`（a++）++ +b`，而`a++`不能作为左值，所以应解释为`（a++）+（++b）`

- `y=x/*p`按照贪心法，会把p当作注释语句，导致编译错误，所以应该书写为`y=x/（*p）`

 

3.表达式中求值中的类型转换

- 自动转换的原则

- 若参与运算类型不同，则先转换为同一类型

- 转换按数据长度增加的方向进行，以保证精度不降低

- 所有的浮点运算都是以双精度进行的，即使仅含float单精度运算表达式，也要先转换为double型

- char和short型参与运算时必须先转换为int型

- 幅值运算中，幅值号右边量的类型先转换为左边量的类型。如果右边的数据类型长度比左边长，将丢失一部分数据，降低精度，丢失的部分按照四舍五入向前舍入。

- 隐式转换见书25页-27页

 

4.表达式求值的副作用

一个表达式在求值的过程中对使用的变量不但引用，还对它们的值加以修改，这样的表达式称为有副作用的表达式，例如：x=x++，有两个副作用，因为x值发生了两次修改.

 

> a[i]=i++;

>

> 问题是：数组下标i是引用旧值还是引用新值？对这种情况编译器的解释可能不同，并因此产生不同的结果。C语言标准对大多数这类问题有意未做具体规定。表达式何时会产生这种副作用（对变量赋值），将由编译器决定，因为最佳的求值顺序同机器结构有很大关系。（ANSI C标准明确规定了所有对参数的副作用都必须在函数调用之前生效，但这对前面介绍的printf函数调用并没有什么帮助）。

>

> 在任何一种编程语言中，如果代码的执行结果与求值顺序相关，则都是不好的程序设计风格。很自然，有必要了解哪些问题需要避免。但是，如果不知道这些问题在各种机器上是如何解决的，就最好不要常识运用某种特殊的实现方式。

>

> K&R.The C Programming Language.43页





